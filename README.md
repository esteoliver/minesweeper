# minesweeper

Develop the classic game of [Minesweeper](https://en.wikipedia.org/wiki/Minesweeper_(video_game)).

Implementation of an minesweeper on Ruby on Rails, for Deviget challenge. 
You can play [here](https://esteoliver-minesweeper.herokuapp.com/).

## The Challenge
* [X] Design and implement a documented RESTful API for the game (think of a mobile app for your API)
* [X] Implement an API client library for the API designed above. Ideally, in a different language, of your preference, to the one used for the API
* [X] When a cell with no adjacent mines is revealed, all adjacent squares will be revealed (and repeat)
* [X] Ability to 'flag' a cell with a question mark or red flag
* [X] Detect when game is over
* [X] Persistence
* [X] Time tracking
* [X] Ability to start a new game and preserve/resume the old ones
* [X] Ability to select the game parameters: number of rows, columns, and mines
* [X] Ability to support multiple users/accounts
* [X] URL where the game can be accessed and played
* [X] Code in a public Github repo
* [X] README file with the decisions taken and important notes


## How it works?

This implementation have:
- RESTful API, to start and manipulate games.
- Client UI, to interact with a board and play the game.
- API Client in JavaScript, to make the use of the API easier from client side.

## RESTful API

Built in Ruby on Rails, given my experience with teh language and the framework. 
Also, RoR is an easy framework to work with given that works by conventions over 
configurations.
- Used [devise](https://github.com/heartcombo/devise) for authentication of users.
- Used [fast_jsonapi](https://github.com/heartcombo/devise) for JSON API 
  serialization.
- Used [kaminari](https://github.com/kaminari/kaminari) for pagination.
- Used PostgreSQL as my default database, to store `Players` and `Games`.
- The game can be played by anonymous players. To support this, I use Redis as a 
  database. The reason behind this is:
  - After a while, those games expires, and there's no need to make any manual 
  cleanup. If I use PostgreSQL, I'll have alot of trash records.
  - As a key-value database, an anonymous player receive an autogenerated ID and 
  can only play one game at a time.
  - Because Redis works on memory, the retrieving of the game is better than 
  coming from PostgreSQL (think in multiple users playing at the same time)

| Endpoint |     | Params | Body | Result |
|----------|-----|--------|------|--------|
| `GET /api/v1/games` | List games of logged in player | `page={{page_number}}` | | `{ data: [ ... list of games ... ], meta: { current_page: 1, total_pages: '10' } }` |
| `GET /api/v1/games/:game_id` | Fetch the game, if belongs to the player | `game_id={id | current}` | | Game * |
| `POST /api/v1/games/:game_id` | Create a new game | | `{ "game": { "level": {beginner|intermediate|expert|custom}, "rows": INT, "columns": INT, "mines": INT }}`  | Game * |
| `PUT /api/v1/games/:game_id/reveal` | Reveal a cell of the board | | `{ "player_action": { "x": INT, "y": INT }}`  | Game * |
| `PUT /api/v1/games/:game_id/flag` | Put a flag on a cell of the board | | `{ "player_action": { "x": INT, "y": INT }}`  | Game * |
| `PUT /api/v1/games/:game_id/unflag` | Remove flag on cell of the board | | `{ "player_action": { "x": INT, "y": INT }}`  | Game * |
| `POST /api/v1/auth/sign_in` | Login | | `{ "player": { "nickname": "esteoliver", "password": "******" }}`  | |
| `DELETE /api/v1/auth/sign_out` | Logout | | | |
| `POST /api/v1/auth` | Register | | `{ "player": { "email": "test@test.com", "nickname": "esteoliver", "password": "******" }}`  | |

**\* Game representation**
```javascript
{ 
  "data": { 
    "id": 1, 
    "type": "game", 
    "attributes": { 
      "player_id": 1,   // can be null, wich represent an anonymous player
      "rows": 3,
      "columns": 3,
      "over": false, 
      "winner": false, // For a game to be lost or won, over must be true
      "time": 0,       // Time spent since the creation of the game. Only set on over
      "created_at": "2020-05-15T10:29:20.133Z",
      "display": "HHHHHHHHH", 
      "mines": 3, 
      "flags": 1       // nuber of flag set by the player
    }
  } 
}
```

#### Next steps
- Add testing with Rspec
- Clean the code and remove some repetitions.
- Crealy separate Game/Board classes responsabilities.
- Fetch recently played games of non-anonymous players on Redis
- Update games on PostgreSQL by task using [sidekiq](https://github.com/mperham/sidekiq).
  - This way we reduce the latency of multiple actions over the board. 
  - We could store a fresh copy on Redis, manipulate that in each action, and 
  submit a task to update the record on PostgreSQL.
- Improve the authentication progress with [devise-jwt](https://github.com/waiting-for-dev/devise-jwt).
- Separate RESTful API into a different repo.
- Add a **Leaderboard** feature, can be stored on Redis and create an endpoint to see
the Top 10 players.
- Add some mechanism to manipulate the time spent in the game, and not use
the `created_at` field as the starting point.

## Client UI

Simple UI to create and manipulates games, using the RESTful API. To help me with
this simple UI:
  - Used jQuery, for element manipulations.
  - Used [momentjs](https://momentjs.com/).
  - For style, [98.css](https://jdan.github.io/98.css/).+

#### Next steps
- Use a moder JavaScript framework, like AngularJS, ReactJS, or VueJs.

## API Client

To make things easier, this project also have a little JavaScript client library
to use the RESTful API, [here](https://github.com/esteoliver/minesweeper/blob/master/app/javascript/packs/apiClient.js)

#### Next steps
- Use `Promises` and `async`
- Define and process API responses, instead of returning the raw response on the callback.
